@page
@model WARazor.Pages.IndexModel
@{
    ViewData["Title"] = "Registrar tareas";
    Layout = "_Layout";
}

@section Toolbar {
    <a class="btn btn-success" data-bs-toggle="modal" data-bs-target="#mdlNuevaTarea">
        <i class="fa fa-plus"></i> Registrar tarea
    </a>
    <a class="btn btn-outline-light" asp-page="/Index">
        <i class="fa fa-rotate-right"></i> Refrescar
    </a>
}

<div class="container-fluid">
    <div class="mb-3"></div>

    <!-- Filtros -->
    <form method="get" class="row g-2 align-items-end mb-3 filters">
        <div class="col-12 col-sm-6 col-md-4">
            <label class="form-label mb-1">Buscar</label>
            <input type="text" name="q" value="@Model.Buscar"
                   class="form-control" placeholder="Nombre de la tarea..." />
        </div>
        <div class="col-6 col-md-3">
            <label class="form-label mb-1">Orden</label>
            <select name="order" class="form-select">
                <option value="az" selected="@("az"==Model.Orden)">A → Z</option>
                <option value="za" selected="@("za"==Model.Orden)">Z → A</option>
                <option value="fasc" selected="@("fasc"==Model.Orden)">Fecha ↑</option>
                <option value="fdesc" selected="@("fdesc"==Model.Orden)">Fecha ↓</option>
            </select>
        </div>
        <div class="col-6 col-md-2">
            <label class="form-label mb-1">Tamaño</label>
            <select name="tam" class="form-select">
                <option value="5" selected="@(Model.TamanoPagina==5)">5</option>
                <option value="10" selected="@(Model.TamanoPagina==10)">10</option>
                <option value="20" selected="@(Model.TamanoPagina==20)">20</option>
            </select>
        </div>
        <div class="col-12 col-md-3">
            <button class="btn btn-outline-secondary w-100">Aplicar</button>
        </div>
    </form>

    <!-- Tabla -->
    <div class="table-responsive shadow-card p-2">
        <table class="table table-hover align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>Nombre Tarea</th>
                    <th>Fecha Vencimiento</th>
                    <th>Estado</th>
                    <th style="width:140px">Acciones</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var t in Model.Tareas)
                {
                    <tr>
                        <td>@t.nombreTarea</td>
                        <td>@t.fechaVencimiento.ToString("dd/MM/yyyy")</td>
                        <td>
                            <span class="badge @(t.estado switch {
                            "Pendiente"  => "bg-warning text-dark",
                            "En curso"   => "bg-info",
                            "Finalizado" => "bg-success",
                            "Cancelado"  => "bg-danger",
                            _            => "bg-secondary"
                        })">@t.estado</span>
                        </td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary">Ver</button>
                            <button class="btn btn-sm btn-outline-danger">Eliminar</button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>

    <!-- Paginación -->
    <nav aria-label="Paginación" class="mt-3">
        <ul class="pagination justify-content-center">
            <li class="page-item @(Model.PaginaActual==1 ? "disabled" : "")">
                <a class="page-link"
                   asp-page="/Index"
                   asp-route-pagina="@(Model.PaginaActual-1)"
                   asp-route-q="@Model.Buscar"
                   asp-route-order="@Model.Orden"
                   asp-route-tam="@Model.TamanoPagina">Anterior</a>
            </li>

            @for (int i = 1; i <= Model.TotalPaginas; i++)
            {
                <li class="page-item @(i==Model.PaginaActual ? "active" : "")">
                    <a class="page-link"
                       asp-page="/Index"
                       asp-route-pagina="@i"
                       asp-route-q="@Model.Buscar"
                       asp-route-order="@Model.Orden"
                       asp-route-tam="@Model.TamanoPagina">@i</a>
                </li>
            }

            <li class="page-item @(Model.PaginaActual==Model.TotalPaginas ? "disabled" : "")">
                <a class="page-link"
                   asp-page="/Index"
                   asp-route-pagina="@(Model.PaginaActual+1)"
                   asp-route-q="@Model.Buscar"
                   asp-route-order="@Model.Orden"
                   asp-route-tam="@Model.TamanoPagina">Siguiente</a>
            </li>
        </ul>
    </nav>
</div>

<!-- Modal Registrar (si aún no guardas, deja en blanco 'method') -->
<div class="modal fade" id="mdlNuevaTarea" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <form class="modal-content" method="post" asp-page-handler="Create">
            <div class="modal-header">
                <h5 class="modal-title">Registrar tarea</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-2">
                    <label class="form-label">Nombre</label>
                    <input class="form-control" name="Nueva.nombreTarea" required />
                </div>
                <div class="mb-2">
                    <label class="form-label">Fecha vencimiento</label>
                    <input type="date" class="form-control" name="Nueva.fechaVencimiento" required />
                </div>
                <div class="mb-2">
                    <label class="form-label">Estado</label>
                    <select class="form-select" name="Nueva.estado" required>
                        <option>Pendiente</option>
                        <option>En curso</option>
                        <option>Finalizado</option>
                        <option>Cancelado</option>
                    </select>
                </div>
                <small class="text-muted">Se guardará en <code>wwwroot/tareas.json</code>.</small>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">Cerrar</button>
                <button class="btn btn-primary" type="submit">Guardar</button>
            </div>
        </form>
    </div>
</div>
